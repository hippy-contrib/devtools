{"version":3,"file":"SimpleHistoryManager.js","sourceRoot":"","sources":["../../../../../../chrome-devtools/front_end/core/common/SimpleHistoryManager.ts"],"names":[],"mappings":"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","sourcesContent":["/*\n * Copyright (C) 2014 Google Inc. All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are\n * met:\n *\n *     * Redistributions of source code must retain the above copyright\n * notice, this list of conditions and the following disclaimer.\n *     * Redistributions in binary form must reproduce the above\n * copyright notice, this list of conditions and the following disclaimer\n * in the documentation and/or other materials provided with the\n * distribution.\n *     * Neither the name of Google Inc. nor the names of its\n * contributors may be used to endorse or promote products derived from\n * this software without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n * \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n/**\n * @interface\n */\n/* eslint-disable rulesdir/no_underscored_properties */\n\nexport interface HistoryEntry {\n  valid(): boolean;\n\n  reveal(): void;\n}\n\nexport class SimpleHistoryManager {\n  private entries: HistoryEntry[];\n  private activeEntryIndex: number;\n  private coalescingReadonly: number;\n  private readonly historyDepth: number;\n  constructor(historyDepth: number) {\n    this.entries = [];\n    this.activeEntryIndex = -1;\n\n    // Lock is used to make sure that reveal() does not\n    // make any changes to the history while we are\n    // rolling back or rolling over.\n    this.coalescingReadonly = 0;\n    this.historyDepth = historyDepth;\n  }\n\n  _readOnlyLock(): void {\n    ++this.coalescingReadonly;\n  }\n\n  _releaseReadOnlyLock(): void {\n    --this.coalescingReadonly;\n  }\n\n  _getPreviousValidIndex(): number {\n    if (this.empty()) {\n      return -1;\n    }\n\n    let revealIndex = this.activeEntryIndex - 1;\n    while (revealIndex >= 0 && !this.entries[revealIndex].valid()) {\n      --revealIndex;\n    }\n    if (revealIndex < 0) {\n      return -1;\n    }\n\n    return revealIndex;\n  }\n\n  _getNextValidIndex(): number {\n    let revealIndex = this.activeEntryIndex + 1;\n\n    while (revealIndex < this.entries.length && !this.entries[revealIndex].valid()) {\n      ++revealIndex;\n    }\n    if (revealIndex >= this.entries.length) {\n      return -1;\n    }\n\n    return revealIndex;\n  }\n\n  _readOnly(): boolean {\n    return Boolean(this.coalescingReadonly);\n  }\n\n  filterOut(filterOutCallback: (arg0: HistoryEntry) => boolean): void {\n    if (this._readOnly()) {\n      return;\n    }\n    const filteredEntries = [];\n    let removedBeforeActiveEntry = 0;\n    for (let i = 0; i < this.entries.length; ++i) {\n      if (!filterOutCallback(this.entries[i])) {\n        filteredEntries.push(this.entries[i]);\n      } else if (i <= this.activeEntryIndex) {\n        ++removedBeforeActiveEntry;\n      }\n    }\n    this.entries = filteredEntries;\n    this.activeEntryIndex = Math.max(0, this.activeEntryIndex - removedBeforeActiveEntry);\n  }\n\n  empty(): boolean {\n    return !this.entries.length;\n  }\n\n  active(): HistoryEntry|null {\n    return this.empty() ? null : this.entries[this.activeEntryIndex];\n  }\n\n  push(entry: HistoryEntry): void {\n    if (this._readOnly()) {\n      return;\n    }\n    if (!this.empty()) {\n      this.entries.splice(this.activeEntryIndex + 1);\n    }\n    this.entries.push(entry);\n    if (this.entries.length > this.historyDepth) {\n      this.entries.shift();\n    }\n    this.activeEntryIndex = this.entries.length - 1;\n  }\n\n  canRollback(): boolean {\n    return this._getPreviousValidIndex() >= 0;\n  }\n\n  canRollover(): boolean {\n    return this._getNextValidIndex() >= 0;\n  }\n\n  rollback(): boolean {\n    const revealIndex = this._getPreviousValidIndex();\n    if (revealIndex === -1) {\n      return false;\n    }\n    this._readOnlyLock();\n    this.activeEntryIndex = revealIndex;\n    this.entries[revealIndex].reveal();\n    this._releaseReadOnlyLock();\n\n    return true;\n  }\n\n  rollover(): boolean {\n    const revealIndex = this._getNextValidIndex();\n    if (revealIndex === -1) {\n      return false;\n    }\n\n    this._readOnlyLock();\n    this.activeEntryIndex = revealIndex;\n    this.entries[revealIndex].reveal();\n    this._releaseReadOnlyLock();\n\n    return true;\n  }\n}\n"]}